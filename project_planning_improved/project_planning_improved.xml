<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <!--Project-->
        <record model="ir.ui.view" id="project_improved_project_form">
            <field name="name">project_improved_project_form</field>
            <field name="model">project.project</field>
            <field name="inherit_id" ref="project.edit_project"/>
            <field name="priority" eval="16"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='partner_id']" position="after">
                    <field name="reference_task_id" context="{'default_project_id': id}"
                           domain="[('project_id', '=', id)]"/>
                    <field name="reference_task_end_date" widget="date"/>
                </xpath>
                <group name="misc" position="before">
                    <button name="open_task_planning" string="Open tasks planning" type="object"/>
                    <button name="start_auto_planning" type="object" string="Start auto-planning"/>
                </group>
            </field>
        </record>

        <!--Task-->
        <record model="ir.ui.view" id="project_improved_task_tree">
            <field name="name">project_improved_task_tree</field>
            <field name="model">project.task</field>
            <field name="priority" eval="999"/>
            <field name="arch" type="xml">
                <tree string="Tasks planning" editable="top" create="false">
                    <field name="project_id"/>
                    <field name="name"/>
                    <field name="kanban_state"/>
                    <field name="critical_task"/>
                    <field name="objective_duration"/>
                    <field name="taken_into_account"/>
                    <field name="expected_start_date" widget="date" attrs="{'required': [('taken_into_account', '=', True)]}"/>
                    <field name="objective_start_date" widget="date" attrs="{'required': [('taken_into_account', '=', True)]}"/>
                    <field name="expected_end_date" widget="date"/>
                    <field name="objective_end_date" widget="date"/>
                    <field name="parent_task_id" context="{'default_project_id': project_id}" domain="[('project_id', '=', project_id)]"/>
                    <field name="previous_task_ids" widget="many2many_tags" context="{'default_project_id': project_id}" domain="[('project_id', '=', project_id)]"/>
                    <field name="next_task_ids" widget="many2many_tags" context="{'default_project_id': project_id}" domain="[('project_id', '=', project_id)]"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="project_improved_task_tree2">
            <field name="name">project_improved_task_tree2</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="project.view_task_tree2"/>
            <field name="arch" type="xml">
                <tree position="inside">
                    <field name="critical_task"/>
                    <field name="objective_duration"/>
                    <field name="parent_task_id"/>
                    <field name="taken_into_account"/>
                    <field name="expected_start_date" widget="date" attrs="{'required': [('taken_into_account', '=', True)]}"/>
                    <field name="objective_start_date" widget="date"/>
                    <field name="expected_end_date" widget="date" attrs="{'required': [('taken_into_account', '=', True)]}"/>
                    <field name="objective_end_date" widget="date"/>
                    <field name="previous_task_ids" widget="many2many_tags"/>
                    <field name="next_task_ids" widget="many2many_tags"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="project_improved_task_search">
            <field name="name">project_improved_task_search</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="project.view_task_search_form"/>
            <field name="priority" eval="16"/>
            <field name="arch" type="xml">
                <search position="inside">
                    <filter name="critical_task" string="Critical task" domain="[('critical_task', '=', True)]"/>
                </search>
            </field>
        </record>

        <record model="ir.ui.view" id="project_improved_task_form">
            <field name="name">project_improved_task_form</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="project.view_task_form2"/>
            <field name="priority" eval="16"/>
            <field name="arch" type="xml">
                <sheet position="attributes">
                    <attribute name="class">oe_form_sheet_full_screen</attribute>
                </sheet>
                <field name="tag_ids" position="after">
                    <field name="critical_task"/>
                </field>
                <field name="planned_hours" position="after">
                    <field name="objective_duration"/>
                </field>
                <xpath expr="//notebook" position="before">
                    <group>
                        <group>
                            <field name="objective_start_date" widget="date"/>
                            <field name="expected_start_date" widget="date" attrs="{'required': [('taken_into_account', '=', True)]}"/>
                            <field name="allocated_duration"/>
                            <field name="allocated_duration_unit_tasks"/>
                        </group>
                        <group>
                            <field name="objective_end_date" widget="date"/>
                            <field name="expected_end_date" widget="date" attrs="{'required': [('taken_into_account', '=', True)]}"/>
                            <field name="total_allocated_duration"/>
                            <field name="taken_into_account"/>
                        </group>
                    </group>
                </xpath>
                <notebook position="inside">
                    <page string="Links">
                        <group>
                            <field name="parent_task_id" context="{'default_project_id': project_id}"
                                   domain="[('project_id', '=', project_id)]"/>
                        </group>
                        <separator string="Previous tasks"/>
                        <field name="previous_task_ids" context="{'default_project_id': project_id}"
                               domain="[('project_id', '=', project_id)]"/>
                        <separator string="Next tasks"/>
                        <field name="next_task_ids" context="{'default_project_id': project_id}"
                               domain="[('project_id', '=', project_id)]"/>
                        <separator string="Children tasks"/>
                        <field name="children_task_ids" context="{'default_project_id': project_id}"
                               domain="[('project_id', '=', project_id)]"/>
                    </page>
                </notebook>
            </field>
        </record>

        <record model="ir.actions.act_window" id="act_window_open_task_planning">
            <field name="name">Tasks planning</field>
            <field name="res_model">project.task</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree</field>
            <field name="domain">[]</field>
            <field name="context">{}</field>
            <field name="help"></field>
            <field name="view_id" ref="project_improved_task_tree"/>
        </record>

        <menuitem id="menu_open_task_planning" name="Tasks planning" action="act_window_open_task_planning"
                  parent="project.menu_project_management" sequence="6"/>

        <record id="project_task_timeline" model="ir.ui.view">
            <field name="name">project_task_timeline</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="project_timeline.project_task_timeline"/>
            <field name="type">timeline</field>
            <field name="arch" type="xml">
                <timeline position="attributes">
                    <attribute name="date_start">objective_start_date</attribute>
                    <attribute name="date_stop">objective_end_date</attribute>
                </timeline>
            </field>
        </record>

    </data>
</openerp>