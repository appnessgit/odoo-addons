<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <record model="ir.ui.view" id="project_improved_project_form">
            <field name="name">project_improved_project_form</field>
            <field name="model">project.project</field>
            <field name="inherit_id" ref="project.edit_project"/>
            <field name="priority" eval="16"/>
            <field name="arch" type="xml">
                <group name="misc" position="before">
                    <button name="open_task_planning" string="Open tasks planning" type="object"/>
                </group>
            </field>
        </record>

        <record model="ir.ui.view" id="project_improved_task_tree">
            <field name="name">project_improved_task_tree</field>
            <field name="model">project.task</field>
            <field name="priority" eval="999"/>
            <field name="arch" type="xml">
                <tree string="Tasks planning" editable="top" create="false">
                    <field name="name"/>
                    <field name="kanban_state"/>
                    <field name="date_start"/>
                    <field name="date_end"/>
                    <field name="date_deadline"/>
                    <field name="critical_task"/>
                    <field name="planned_days"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="project_improved_task_tree2">
            <field name="name">project_improved_task_tree2</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="project.view_task_tree2"/>
            <field name="arch" type="xml">
                <tree position="inside">
                    <field name="critical_task"/>
                    <field name="planned_days"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="project_improved_task_search">
            <field name="name">project_improved_task_search</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="project.view_task_search_form"/>
            <field name="priority" eval="16"/>
            <field name="arch" type="xml">
                <search position="inside">
                    <filter name="critical_task" string="Critical task" domain="[('critical_task', '=', True)]"/>
                </search>
            </field>
        </record>

        <record model="ir.ui.view" id="project_improved_task_form">
            <field name="name">project_improved_task_form</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="project.view_task_form2"/>
            <field name="priority" eval="16"/>
            <field name="arch" type="xml">
                <field name="tag_ids" position="after">
                    <field name="critical_task"/>
                </field>
                <field name="planned_hours" position="after">
                    <field name="planned_days"/>
                </field>
                <notebook position="inside">
                    <page string="Links">
                        <group>
                            <field name="parent_task_id" context="{'default_project_id': id}"
                                   domain="[('project_id', '=', id)]"/>
                        </group>
                        <separator string="Previous tasks"/>
                        <field name="previous_task_ids" context="{'default_project_id': id}"
                               domain="[('project_id', '=', id)]"/>
                        <separator string="Next tasks"/>
                        <field name="next_task_ids" context="{'default_project_id': id}"
                               domain="[('project_id', '=', id)]"/>
                    </page>
                </notebook>
            </field>
        </record>

        <record model="ir.actions.act_window" id="act_window_open_task_planning">
            <field name="name">Tasks planning</field>
            <field name="res_model">project.task</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree</field>
            <field name="domain">[]</field>
            <field name="context">{}</field>
            <field name="help"></field>
             <field name="view_id" ref="project_improved_task_tree"/>
        </record>

        <menuitem id="menu_open_task_planning" name="Tasks planning" action="act_window_open_task_planning"
                  parent="project.menu_project_management" sequence="6"/>

    </data>
</openerp>