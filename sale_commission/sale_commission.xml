<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <record model="ir.ui.view" id="sale_commission_product_template_form">
            <field name="name">sale_commission_product_template_form</field>
            <field name="model">product.template</field>
            <field name="inherit_id" ref="product.product_template_only_form_view"/>
            <field name="priority" eval="16"/>
            <field name="arch" type="xml">
                <field name="barcode" position="after">
                    <field name="commission_rate" attrs="{'invisible': [('purchase_ok', '=', False)]}"/>
                </field>
            </field>
        </record>

        <record model="ir.ui.view" id="sale_commission_tree">
            <field name="name">sale_commission_tree</field>
            <field name="model">sale.commission</field>
            <field name="priority" eval="16"/>
            <field name="arch" type="xml">
                <tree editable="top">
                    <field name="supplier_id"/>
                    <field name="partner_id"/>
                    <field name="categ_id"/>
                    <field name="sold_product_id"/>
                    <field name="commission_product_id"/>
                    <field name="commission_rate"/>
                    <field name="date_begin"/>
                    <field name="date_end"/>
                </tree>
            </field>
        </record>

        <record model="ir.actions.act_window" id="act_window_sale_commission">
            <field name="name">Sale Commissions</field>
            <field name="res_model">sale.commission</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree</field>
            <field name="domain">[]</field>
            <field name="context">{}</field>
            <field name="help"></field>
        </record>

        <menuitem id="menu_sale_commission" name="Sale Commissions" action="act_window_sale_commission"
                  parent="base.menu_sales" sequence="150"/>

        <record model="ir.ui.view" id="sale_commission_sale_order_form">
            <field name="name">sale_commission_sale_order_form</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="priority" eval="16"/>
            <field name="arch" type="xml">
                <field name="payment_term_id" position="after">
                    <field name="supplier_id" attrs="{'required': [('commission_product_id', '!=', False)]}"/>
                    <field name="commission_product_id" attrs="{'required': [('supplier_id', '!=', False)], 'invisible': [('supplier_id', '=', False)]}"/>
                    <field name="commission_rate" attrs="{'invisible': [('supplier_id', '=', False)], 'required': ['|', ('supplier_id', '!=', False), ('commission_product_id', '!=', False)]}"/>
                </field>
                <xpath expr="//field[@name='order_line']/tree//field[@name='price_subtotal']" position="before">
                    <field name="supplier_id" attrs="{'required': [('commission_product_id', '!=', False)]}"/>
                    <field name="commission_product_id" attrs="{'required': [('supplier_id', '!=', False)]}"/>
                    <field name="commission_rate" attrs="{'required': ['|', ('supplier_id', '!=', False), ('commission_product_id', '!=', False)]}"/>
                </xpath>
            </field>
        </record>

    </data>
</openerp>